<!DOCTYPE html>
<html>
<head>
  <title>VTF Audio Extension - Settings</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Options page specific styles */
    body.options-page {
      background: #f5f5f5;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .options-header {
      background: var(--primary);
      color: white;
      padding: 40px;
      text-align: center;
      position: relative;
    }

    .options-header h1 {
      margin: 0 0 8px 0;
      font-size: 32px;
      font-weight: 300;
    }

    .version-info {
      opacity: 0.8;
      font-size: 14px;
    }

    .options-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .options-section {
      background: white;
      border-radius: 8px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .options-section h2 {
      margin: 0 0 24px 0;
      font-size: 20px;
      color: #333;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 12px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
      font-size: 14px;
    }

    .form-group input[type="checkbox"] {
      margin-right: 8px;
    }

    .input-group {
      display: flex;
      gap: 8px;
    }

    input[type="text"],
    input[type="password"],
    input[type="url"],
    input[type="number"],
    select {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: var(--primary);
    }

    .btn-icon {
      background: none;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 40px;
      height: 40px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s;
    }

    .btn-icon:hover {
      background: #f5f5f5;
      border-color: #ccc;
    }

    .help-text {
      font-size: 13px;
      color: #666;
      margin-top: 6px;
    }

    .help-text a {
      color: var(--primary);
      text-decoration: none;
    }

    .help-text a:hover {
      text-decoration: underline;
    }

    /* Speaker mappings */
    .speaker-mappings {
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 16px;
    }

    .speaker-mapping-header {
      display: grid;
      grid-template-columns: 2fr 2fr 80px;
      gap: 12px;
      padding: 12px 16px;
      background: #f5f5f5;
      font-weight: 500;
      font-size: 13px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .speaker-mapping-row {
      display: grid;
      grid-template-columns: 2fr 2fr 80px;
      gap: 12px;
      padding: 12px 16px;
      border-top: 1px solid #f0f0f0;
      align-items: center;
    }

    .speaker-mapping-row:hover {
      background: #f9f9f9;
    }

    .user-id {
      font-family: monospace;
      font-size: 12px;
      color: #666;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .speaker-name-input {
      padding: 6px 10px !important;
      font-size: 13px !important;
    }

    .delete-speaker {
      width: auto;
      padding: 6px 12px;
      background: #fee;
      border-color: #fcc;
      color: var(--danger);
    }

    .delete-speaker:hover {
      background: #fdd;
      border-color: #fbb;
    }

    /* Range slider */
    input[type="range"] {
      width: 200px;
      margin-right: 12px;
    }

    #bufferDurationValue {
      display: inline-block;
      width: 40px;
      font-weight: 500;
      color: var(--primary);
    }

    /* Button groups */
    .button-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: #2a4460;
      box-shadow: 0 2px 8px rgba(55, 90, 127, 0.3);
    }

    .btn-secondary {
      background: #e9ecef;
      color: #333;
    }

    .btn-secondary:hover {
      background: #dee2e6;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background: #d62c1a;
    }

    /* Stats display */
    .stats-display {
      margin-top: 20px;
      padding: 16px;
      background: #f5f5f5;
      border-radius: 4px;
      font-size: 13px;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .stat-row:last-child {
      margin-bottom: 0;
    }

    .stat-label {
      color: #666;
    }

    .stat-value {
      font-weight: 500;
      color: #333;
    }

    /* Messages */
    .message-container {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
    }

    .success-message,
    .error-message {
      padding: 12px 24px;
      border-radius: 4px;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from { transform: translate(-50%, 100%); opacity: 0; }
      to { transform: translate(-50%, 0); opacity: 1; }
    }

    .success-message {
      background: var(--success);
      color: white;
    }

    .error-message {
      background: var(--danger);
      color: white;
    }

    .hidden {
      display: none !important;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 8px;
      padding: 30px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      margin-bottom: 20px;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 20px;
    }

    .modal-body {
      margin-bottom: 24px;
    }

    .modal-footer {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }
  </style>
</head>
<body class="options-page">
  <div class="options-header">
    <h1>VTF Audio Extension Settings</h1>
    <div class="version-info">Version 2.0.0</div>
  </div>
  
  <div class="options-container">
    <!-- API Configuration -->
    <section class="options-section">
      <h2>API Configuration</h2>
      
      <div class="form-group">
        <label for="apiKey">OpenAI API Key</label>
        <div class="input-group">
          <input type="password" id="apiKey" placeholder="sk-..." />
          <button id="toggleApiKey" class="btn-icon" title="Toggle visibility">üëÅÔ∏è</button>
        </div>
        <div class="help-text">
          Get your API key from <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a>
        </div>
      </div>
      
      <div class="form-group">
        <label for="apiEndpoint">API Endpoint (Advanced)</label>
        <input type="url" id="apiEndpoint" placeholder="https://api.openai.com/v1/audio/transcriptions" />
        <div class="help-text">
          Leave blank to use default OpenAI endpoint
        </div>
      </div>
      
      <button id="saveApiBtn" class="btn btn-primary">Save API Settings</button>
    </section>
    
    <!-- Speaker Mapping -->
    <section class="options-section">
      <h2>Speaker Identification</h2>
      
      <div class="speaker-mappings" id="speakerMappings">
        <div class="speaker-mapping-header">
          <span>User ID</span>
          <span>Speaker Name</span>
          <span>Actions</span>
        </div>
        <!-- Dynamic speaker mappings will be inserted here -->
      </div>
      
      <div class="button-group">
        <button id="addSpeakerBtn" class="btn btn-secondary">+ Add Speaker</button>
        <button id="importSpeakersBtn" class="btn btn-secondary">Import</button>
        <button id="exportSpeakersBtn" class="btn btn-secondary">Export</button>
        <button id="autoLearnToggle" class="btn btn-secondary">Auto-Learn: <span id="autoLearnStatus">Off</span></button>
      </div>
    </section>
    
    <!-- Capture Settings -->
    <section class="options-section">
      <h2>Capture Settings</h2>
      
      <div class="form-group">
        <label>
          <input type="checkbox" id="autoStart" />
          Auto-start capture when visiting VTF
        </label>
      </div>
      
      <div class="form-group">
        <label for="bufferDuration">Buffer Duration</label>
        <div>
          <input type="range" id="bufferDuration" min="0.5" max="5" step="0.5" value="1.5" />
          <span id="bufferDurationValue">1.5s</span>
        </div>
        <div class="help-text">How long to buffer audio before sending to transcription</div>
      </div>
      
      <div class="form-group">
        <label for="silenceThreshold">Silence Detection Sensitivity</label>
        <select id="silenceThreshold">
          <option value="0.001">High (Default)</option>
          <option value="0.005">Medium</option>
          <option value="0.01">Low</option>
          <option value="0">Disabled</option>
        </select>
        <div class="help-text">Higher sensitivity = more silence detection</div>
      </div>
      
      <div class="form-group">
        <label for="silenceTimeout">Silence Timeout</label>
        <select id="silenceTimeout">
          <option value="1000">1 second</option>
          <option value="2000">2 seconds (Default)</option>
          <option value="3000">3 seconds</option>
          <option value="5000">5 seconds</option>
        </select>
        <div class="help-text">How long to wait before transcribing after silence</div>
      </div>
      
      <button id="saveCaptureBtn" class="btn btn-primary">Save Capture Settings</button>
    </section>
    
    <!-- Advanced Settings -->
    <section class="options-section">
      <h2>Advanced Settings</h2>
      
      <div class="form-group">
        <label>
          <input type="checkbox" id="debugMode" />
          Enable debug logging (Developer mode)
        </label>
      </div>
      
      <div class="form-group">
        <label>
          <input type="checkbox" id="performanceMode" />
          Show performance metrics in popup
        </label>
      </div>
      
      <div class="form-group">
        <label for="maxTranscriptions">Maximum stored transcriptions</label>
        <input type="number" id="maxTranscriptions" min="100" max="10000" step="100" value="1000" />
        <div class="help-text">Older transcriptions will be automatically removed</div>
      </div>
      
      <div class="form-group">
        <label for="maxRetries">Maximum API retry attempts</label>
        <input type="number" id="maxRetries" min="1" max="10" value="5" />
      </div>
      
      <button id="saveAdvancedBtn" class="btn btn-primary">Save Advanced Settings</button>
    </section>
    
    <!-- Data Management -->
    <section class="options-section">
      <h2>Data Management</h2>
      
      <div class="stats-display" id="statsDisplay">
        <div class="stat-row">
          <span class="stat-label">Total Transcriptions:</span>
          <span class="stat-value" id="totalTranscriptions">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Storage Used:</span>
          <span class="stat-value" id="storageUsed">0 KB</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Known Speakers:</span>
          <span class="stat-value" id="knownSpeakers">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Service Uptime:</span>
          <span class="stat-value" id="serviceUptime">Not running</span>
        </div>
      </div>
      
      <div class="button-group" style="margin-top: 20px;">
        <button id="exportDataBtn" class="btn btn-secondary">Export All Data</button>
        <button id="importDataBtn" class="btn btn-secondary">Import Data</button>
        <button id="clearTranscriptionsBtn" class="btn btn-secondary">Clear Transcriptions</button>
        <button id="resetSettingsBtn" class="btn btn-danger">Reset All Settings</button>
      </div>
    </section>
  </div>
  
  <!-- Status messages -->
  <div class="message-container">
    <div class="success-message hidden" id="successMessage"></div>
    <div class="error-message hidden" id="errorMessage"></div>
  </div>
  
  <!-- Add Speaker Modal -->
  <div id="addSpeakerModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add Speaker Mapping</h3>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="newUserId">User ID</label>
          <input type="text" id="newUserId" placeholder="e.g., XRcupJu26dK_sazaAAPK" />
        </div>
        <div class="form-group">
          <label for="newSpeakerName">Speaker Name</label>
          <input type="text" id="newSpeakerName" placeholder="e.g., John Doe" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="document.getElementById('addSpeakerModal').classList.remove('show')">Cancel</button>
        <button id="confirmAddSpeaker" class="btn btn-primary">Add Speaker</button>
      </div>
    </div>
  </div>
  
  <!-- Hidden file input for imports -->
  <input type="file" id="importFileInput" accept=".json" style="display: none;" />
  
  <script src="options.js"></script>
</body>
</html>